var monTableauPersoCF0BED4C19044D588EBF656397EF1EB4;(()=>{"use strict";var e={480:(e,t,o)=>{o.d(t,{SC:()=>p,gj:()=>m});var a=o(674),l=a.z.Tn,i=a.z.Kx;class n extends l{name="actionButton";displayName="Bouton d'action";show=new a.z.jF({name:"show",displayName:"Afficher le bouton d'action",value:!0});slices=[this.show]}class s extends l{name="backgroundContainer";displayName="Fond du conteneur tableau";color=new a.z.sk({name:"color",displayName:"Couleur de fond",value:{value:"#fff"}});slices=[this.color]}class r extends l{name="titresColonnes";displayName="0. TITRES COLONNES";slices=[];constructor(){super();for(let e=1;e<=20;e++)this.slices.push(new a.z.ks({name:"titre"+e,displayName:"Titre Col "+e,value:"",placeholder:"Titre..."}))}}class d extends l{name="selectionMenu";displayName="1. SÃ‰LECTION (Excel)";ligneActive=new a.z.ks({name:"ligneActive",displayName:"Nom exact de la ligne active",value:"",placeholder:"Ex: Chiffre d'affaires"});slices=[this.ligneActive]}class c extends l{name="styleLigne";displayName="2. PERSONNALISATION (Excel)";selector;columnIndex=new a.z.iB({name:"columnIndex",displayName:"NÂ° Colonne",value:1});ordreTri=new a.z.iB({name:"ordreTri",displayName:"Position",value:0});marginTop=new a.z.iB({name:"marginTop",displayName:"Marge Haut",value:0});marginBottom=new a.z.iB({name:"marginBottom",displayName:"Marge Bas",value:0});marginColor=new a.z.sk({name:"marginColor",displayName:"Couleur Marge",value:{value:"transparent"}});isHidden=new a.z.jF({name:"isHidden",displayName:"MASQUER",value:!1});isHeader=new a.z.jF({name:"isHeader",displayName:"Mode Titre",value:!1});customLabel=new a.z.ks({name:"customLabel",displayName:"Renommer",value:"",placeholder:"Nouveau nom..."});customAmount=new a.z.ks({name:"customAmount",displayName:"Remplacer Montant",value:"",placeholder:"Valeur ou vide..."});fontSize=new a.z.iB({name:"fontSize",displayName:"Taille",value:12});fontFamily=new a.z.Cx({name:"fontFamily",displayName:"Police",value:"'Segoe UI', sans-serif"});bgLabel=new a.z.sk({name:"bgLabel",displayName:"Fond LibellÃ©",value:{value:"transparent"}});fillLabel=new a.z.sk({name:"fillLabel",displayName:"Texte LibellÃ©",value:{value:"black"}});boldLabel=new a.z.jF({name:"boldLabel",displayName:"Gras (L)",value:!1});italicLabel=new a.z.jF({name:"italicLabel",displayName:"Italique (L)",value:!1});bgAmount=new a.z.sk({name:"bgAmount",displayName:"Fond Prix",value:{value:"transparent"}});fillAmount=new a.z.sk({name:"fillAmount",displayName:"Texte Prix",value:{value:"black"}});boldAmount=new a.z.jF({name:"boldAmount",displayName:"Gras (P)",value:!1});borderWidth=new a.z.iB({name:"borderWidth",displayName:"Largeur Bordure",value:1});borderColor=new a.z.sk({name:"borderColor",displayName:"Couleur Bordure",value:{value:"#eee"}});slices=[this.columnIndex,this.ordreTri,this.isHidden,this.isHeader,this.marginTop,this.marginBottom,this.marginColor,this.customLabel,this.customAmount,this.fontSize,this.fontFamily,this.fillLabel,this.bgLabel,this.boldLabel,this.italicLabel,this.fillAmount,this.bgAmount,this.boldAmount,this.borderWidth,this.borderColor]}class m extends l{text=new a.z.ks({name:"text",displayName:"Texte",value:"Nouvelle Ligne",placeholder:"LibellÃ©..."});show=new a.z.jF({name:"show",displayName:"Afficher",value:!1});col=new a.z.iB({name:"col",displayName:"Colonne",value:1});pos=new a.z.iB({name:"pos",displayName:"Position",value:0});isHeader=new a.z.jF({name:"isHeader",displayName:"Titre",value:!1});bgColor=new a.z.sk({name:"bgColor",displayName:"Fond",value:{value:"transparent"}});textColor=new a.z.sk({name:"textColor",displayName:"Texte",value:{value:"black"}});marginTop=new a.z.iB({name:"marginTop",displayName:"Marge Haut",value:0});fontSize=new a.z.iB({name:"fontSize",displayName:"Taille",value:12});bold=new a.z.jF({name:"bold",displayName:"Gras",value:!1});italic=new a.z.jF({name:"italic",displayName:"Italique",value:!1});borderWidth=new a.z.iB({name:"borderWidth",displayName:"Largeur Bordure",value:1});borderColor=new a.z.sk({name:"borderColor",displayName:"Couleur Bordure",value:{value:"#eee"}});slices=[this.show,this.text,this.col,this.pos,this.isHeader,this.marginTop,this.textColor,this.bgColor,this.fontSize,this.bold,this.italic,this.borderWidth,this.borderColor]}class u extends l{name="tableBorders";displayName="ðŸ”² BORDURES TABLEAU";borderWidth=new a.z.iB({name:"borderWidth",displayName:"Largeur",value:1});borderColor=new a.z.sk({name:"borderColor",displayName:"Couleur",value:{value:"rgba(0,0,0,0.25)"}});borderStyle=new a.z.PA({name:"borderStyle",displayName:"Style",value:{value:"solid",displayName:"Plein"},items:[{value:"solid",displayName:"Plein"},{value:"dashed",displayName:"Tirets"},{value:"dotted",displayName:"PointillÃ©s"},{value:"double",displayName:"Double"}]});borderRadius=new a.z.iB({name:"borderRadius",displayName:"Arrondi",value:8});slices=[this.borderWidth,this.borderColor,this.borderStyle,this.borderRadius]}class p extends i{titresColonnes=new r;selectionMenu=new d;styleLigne=new c;tableBorders=new u;backgroundContainer=new s;actionButton=new n;cards=[this.titresColonnes,this.selectionMenu,this.styleLigne,this.tableBorders,this.backgroundContainer,this.actionButton]}},639:(e,t,o)=>{function a(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function l(e,t,o){return null==t||"object"==typeof t&&!t.solid?o:t.solid?{value:null==t?void 0:t.solid.color}:(null==e?void 0:e.items)?e.items.find(e=>e.value==t):t}o.d(t,{D:()=>l,y:()=>a})},667:(e,t,o)=>{o.d(t,{A:()=>l});var a=o(754);const l=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var o,l;let i=new e,n=null===(o=null==t?void 0:t.metadata)||void 0===o?void 0:o.objects;return n&&(null===(l=i.cards)||void 0===l||l.forEach(e=>{var t;e instanceof a.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(n,e.name)),(e instanceof a.Tn?[e]:e.groups).forEach(t=>{var o,a,l,i;null===(o=t.topLevelSlice)||void 0===o||o.setPropertiesValues(n,e.name),null===(a=null==t?void 0:t.slices)||void 0===a||a.forEach(t=>{null==t||t.setPropertiesValues(n,e.name)}),null===(i=null===(l=null==t?void 0:t.container)||void 0===l?void 0:l.containerItems)||void 0===i||i.forEach(t=>{var o;null===(o=null==t?void 0:t.slices)||void 0===o||o.forEach(t=>{null==t||t.setPropertiesValues(n,e.name)})})})})),i}buildFormattingModel(e){let t={cards:[]};return e.cards.filter(({visible:e=!0})=>e).forEach(e=>{var o;let l={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane};const i=e.name;if(e.topLevelSlice){let t=e.topLevelSlice.getFormattingSlice(i,this.localizationManager);t.suppressDisplayName=!0,l.topLevelToggle=t}null===(o=e.onPreProcess)||void 0===o||o.call(e);const n=e instanceof a.Tn;(n?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(e=>{const t=e.name+"-group",o={displayName:n?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:n?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};l.groups.push(o);const a={};if(e.container){const l=e.container,n=t+"-container",s={displayName:this.localizationManager&&l.displayNameKey?this.localizationManager.getDisplayName(l.displayNameKey):l.displayName,description:this.localizationManager&&l.descriptionKey?this.localizationManager.getDisplayName(l.descriptionKey):l.description,containerItems:[],uid:n};l.containerItems.forEach(e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,o=n+t;let l={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:o};this.buildFormattingSlices({slices:e.slices,objectName:i,sliceNames:a,formattingSlices:l.slices}),s.containerItems.push(l)}),o.container=s}if(e.slices){if(e.topLevelSlice){let t=e.topLevelSlice.getFormattingSlice(i,this.localizationManager);t.suppressDisplayName=!0,(null==o.displayName?l:o).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:i,sliceNames:a,formattingSlices:o.slices})}}),l.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(l)}),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:o,formattingSlices:a}){null==e||e.filter(({visible:e=!0})=>e).forEach(e=>{let l=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);l&&(void 0===o[e.name]?o[e.name]=0:(o[e.name]++,l.uid=`${l.uid}-${o[e.name]}`),a.push(l))})}getRevertToDefaultDescriptor(e){var t;const o={};let l,i=[],n=[];return e instanceof a.St&&e.topLevelSlice&&i.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof a.Tn?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(t=>{var a,s;l=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,o,t.topLevelSlice),null===(s=null===(a=t.container)||void 0===a?void 0:a.containerItems)||void 0===s||s.forEach(t=>{n=n.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,o))}),i.push(...l.concat(n))}),i}getSlicesRevertToDefaultDescriptor(e,t,o,a){let l=[];return a&&(o[a.name]=!0,l=l.concat(a.getRevertToDefaultDescriptor(e))),null==t||t.forEach(t=>{t&&!o[t.name]&&(o[t.name]=!0,l=l.concat(t.getRevertToDefaultDescriptor(e)))}),l}}},674:(e,t,o)=>{o.d(t,{O:()=>l.A,z:()=>a});var a=o(754),l=o(667)},754:(e,t,o)=>{o.d(t,{Cx:()=>h,Kx:()=>n,PA:()=>p,St:()=>s,Tn:()=>r,iB:()=>u,jF:()=>c,ks:()=>b,sk:()=>m});var a=o(639);class l{}class i extends l{}class n{}class s extends l{}class r extends i{}class d extends l{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const o=this.type,a=this.name,l={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+a};return Object.assign(Object.assign({},l),{control:{type:o,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:a.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var o;let l=null===(o=null==e?void 0:e[t])||void 0===o?void 0:o[this.name];this.value=a.D(this,l,this.value)}}class c extends d{constructor(e){super(e),this.type="ToggleSwitch"}}class m extends d{constructor(e){super(e),this.type="ColorPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{defaultColor:this.defaultColor,isNoFillItemSupported:this.isNoFillItemSupported})}}class u extends d{constructor(e){super(e),this.type="NumUpDown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{options:this.options})}}class p extends d{constructor(e){super(e),this.type="Dropdown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{items:this.items})}}class b extends d{constructor(e){super(e),this.type="TextInput"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:this.placeholder})}}class h extends d{constructor(){super(...arguments),this.type="FontPicker"}}},849:(e,t,o)=>{o.d(t,{b:()=>i});var a=o(674),l=o(480);class i{target;host;divContainer;flexContainer;allRowsData=[];categoricalData;currentSelectedLabel="";columnTitles=[];metadata;toolbar;pendingChanges=new Map;manualLineKeys=[];areActionButtonsVisible=!1;selectionManager;tableBorderWidth=1;tableBorderColor="rgba(0, 0, 0, 0.25)";tableBorderStyle="solid";tableBorderRadius=8;formattingSettings;formattingSettingsService;licenseManager;currentUserValidPlans;hasServicePlans;isLicenseUnsupportedEnv;isLicenseInfoAvailable;persistStyle(e,t,o="styleLigne"){Object.keys(t||{}).forEach(e=>{void 0===t[e]&&delete t[e]});try{console.log("PERSIST STYLE -> object:",o,"selector:",e,"props:",t),this.host.persistProperties({merge:[{objectName:o,selector:e,properties:t}]}),console.log("PERSIST STYLE OK ->",o)}catch(e){console.error("PERSIST STYLE ERROR:",e)}}handleLicenseNotification(){this.isLicenseUnsupportedEnv?this.licenseManager.notifyLicenseRequired(1):this.hasServicePlans||this.licenseManager.notifyLicenseRequired(2)}constructor(e){this.host=e.host,this.target=e.element,this.formattingSettingsService=new a.O,this.licenseManager=e.host.licenseManager,this.licenseManager.getAvailableServicePlans().then(e=>{this.isLicenseUnsupportedEnv=e.isLicenseUnsupportedEnv,this.isLicenseInfoAvailable=e.isLicenseInfoAvailable,this.isLicenseInfoAvailable&&!this.isLicenseUnsupportedEnv&&(this.currentUserValidPlans=e.plans?.filter(e=>1===e.state||2===e.state),this.hasServicePlans=!!this.currentUserValidPlans?.length),this.handleLicenseNotification()}).catch(e=>{console.error("License check failed:",e),this.currentUserValidPlans=void 0,this.hasServicePlans=void 0}),this.selectionManager=this.host.createSelectionManager(),this.selectionManager=this.host.createSelectionManager(),this.divContainer=document.createElement("div"),this.divContainer.className="scroll-wrapper",this.target.appendChild(this.divContainer),this.flexContainer=document.createElement("div"),this.flexContainer.className="accounting-container",this.divContainer.appendChild(this.flexContainer),this.toolbar=document.createElement("div"),this.toolbar.className="floating-toolbar",this.toolbar.style.display="none",document.body.appendChild(this.toolbar),document.addEventListener("mousedown",e=>{"none"===this.toolbar.style.display||this.toolbar.contains(e.target)||(this.toolbar.style.display="none")})}update(e){e.dataViews&&e.dataViews[0]&&(this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(l.SC,e.dataViews[0]),this.metadata=e.dataViews[0].metadata);let t=!0;for(this.formattingSettings&&this.formattingSettings.actionButton&&"boolean"==typeof this.formattingSettings.actionButton.show.value&&(t=this.formattingSettings.actionButton.show.value),t?(this.divContainer.style.padding="5px",this.divContainer.style.margin="",this.divContainer.style.height="",this.flexContainer.style.height=""):(this.divContainer.style.padding="0",this.divContainer.style.margin="0",this.divContainer.style.height="100%",this.flexContainer.style.height="100%");this.flexContainer.firstChild;)this.flexContainer.removeChild(this.flexContainer.firstChild);this.allRowsData=[],this.manualLineKeys=[];const o=e.dataViews[0];this.metadata=o?o.metadata:null,this.categoricalData=o&&o.categorical?o.categorical:null;let a="#fff";if(this.metadata&&this.metadata.objects&&this.metadata.objects.backgroundContainer&&this.metadata.objects.backgroundContainer.color){const e=this.metadata.objects.backgroundContainer.color;e&&e.solid&&e.solid.color&&(a=e.solid.color)}if(this.divContainer.style.background=a,this.metadata&&this.metadata.objects&&this.metadata.objects.tableBorders){const e=this.metadata.objects.tableBorders;void 0!==e.borderWidth&&(this.tableBorderWidth=e.borderWidth),e.borderColor&&(this.tableBorderColor=e.borderColor.solid.color),e.borderStyle&&(this.tableBorderStyle=e.borderStyle),void 0!==e.borderRadius&&(this.tableBorderRadius=e.borderRadius)}if(console.log("ðŸ”² BORDURES CHARGÃ‰ES:",{width:this.tableBorderWidth,color:this.tableBorderColor,style:this.tableBorderStyle,radius:this.tableBorderRadius}),this.columnTitles=[],this.metadata&&this.metadata.objects&&this.metadata.objects.titresColonnes){const e=this.metadata.objects.titresColonnes;for(let t=1;t<=20;t++){const o="titre"+t;e[o]&&(this.columnTitles[t-1]=e[o])}}let i=1;if(this.categoricalData){const e=this.categoricalData.categories[0],t=this.categoricalData.values?this.categoricalData.values[0]:null;this.metadata&&this.metadata.objects&&this.metadata.objects.selectionMenu&&(this.currentSelectedLabel=this.metadata.objects.selectionMenu.ligneActive),!this.currentSelectedLabel&&e.values.length>0&&(this.currentSelectedLabel=e.values[0].toString()),e.values.forEach((o,a)=>{const l=o.toString();let n={originalName:l,label:l,amount:t?t.values[a]?.toString():"",columnIndex:1,sortIndex:10*a,marginBottom:0,marginTop:0,isHidden:!1,marginColor:"transparent",isHeader:!1,isVirtual:!1,customAmount:"",font:"'Segoe UI', sans-serif",fontSize:12,bgLabel:"transparent",colorLabel:"black",boldLabel:!1,italicLabel:!1,bgAmount:"transparent",colorAmount:"black",boldAmount:!1,borderWidth:1,borderColor:"#eee"};if(e.objects&&e.objects[a]){const t=e.objects[a];if(t.styleLigne){const e=t.styleLigne;e.columnIndex&&(n.columnIndex=e.columnIndex),n.columnIndex<1&&(n.columnIndex=1),void 0!==e.ordreTri&&(n.sortIndex=e.ordreTri),void 0!==e.marginBottom&&(n.marginBottom=e.marginBottom),void 0!==e.marginTop&&(n.marginTop=e.marginTop),e.isHidden&&(n.isHidden=e.isHidden),e.marginColor&&(n.marginColor=e.marginColor.solid.color),e.customLabel&&(n.label=e.customLabel),e.customAmount&&(n.customAmount=e.customAmount),e.isHeader&&(n.isHeader=e.isHeader),e.fontSize&&(n.fontSize=e.fontSize),e.fontFamily&&(n.font=e.fontFamily),e.bgLabel&&(n.bgLabel=e.bgLabel.solid.color),e.fillLabel&&(n.colorLabel=e.fillLabel.solid.color),void 0!==e.boldLabel&&(n.boldLabel=e.boldLabel),void 0!==e.italicLabel&&(n.italicLabel=e.italicLabel),e.bgAmount&&(n.bgAmount=e.bgAmount.solid.color),e.fillAmount&&(n.colorAmount=e.fillAmount.solid.color),void 0!==e.boldAmount&&(n.boldAmount=e.boldAmount),void 0!==e.borderWidth&&(n.borderWidth=e.borderWidth),e.borderColor&&(n.borderColor=e.borderColor.solid.color)}}if(this.pendingChanges.has(l)){const e=this.pendingChanges.get(l);if(Date.now()-e.timestamp<3e4){let t=!0;Object.keys(e).forEach(o=>{if("timestamp"===o)return;let a=!1;a="number"==typeof e[o]&&"number"==typeof n[o]?Math.abs(e[o]-n[o])<.01:e[o]===n[o],a||(n[o]=e[o],t=!1)}),t&&this.pendingChanges.delete(l)}else this.pendingChanges.delete(l)}n.columnIndex>i&&(i=n.columnIndex),this.allRowsData.push(n)})}this.metadata&&this.metadata.objects&&Object.keys(this.metadata.objects).forEach(e=>{if(e.startsWith("manualLine")){this.manualLineKeys.push(e);const t=this.metadata.objects[e];if(!0===t.show){let o=t.text?t.text:"Nouvelle Ligne",a=t.col?t.col:1,l=t.pos?t.pos:0,i=!!t.isHeader&&t.isHeader,n=t.bgColor?t.bgColor.solid.color:"transparent",s=t.textColor?t.textColor.solid.color:"black",r=t.marginTop?t.marginTop:0,d=t.fontSize?t.fontSize:12,c=!!t.bold&&t.bold,m={originalName:e,label:o,amount:"",columnIndex:a,sortIndex:l,marginBottom:0,marginTop:r,isHidden:!1,marginColor:"transparent",isHeader:i,isVirtual:!0,customAmount:"",font:"'Segoe UI', sans-serif",fontSize:d,bgLabel:n,colorLabel:s,boldLabel:c,italicLabel:!!t.italic&&t.italic,bgAmount:n,colorAmount:s,boldAmount:c,borderWidth:void 0!==t.borderWidth?t.borderWidth:1,borderColor:t.borderColor?t.borderColor.solid.color:"#eee"};this.allRowsData.push(m)}}});let n=Math.max(i,this.columnTitles.length);this.flexContainer.style.borderWidth=`${this.tableBorderWidth}px`,this.flexContainer.style.borderStyle=this.tableBorderStyle,this.flexContainer.style.borderColor=this.tableBorderColor,this.flexContainer.style.borderRadius=`${this.tableBorderRadius}px`;for(let e=1;e<=n;e++){const t=document.createElement("div");t.className="dynamic-column";const o=document.createElement("table");t.appendChild(o);const a=this.allRowsData.filter(t=>t.columnIndex===e),l=this.columnTitles[e-1]||"COLONNE "+e,i=this.categoricalData?this.categoricalData.categories[0]:null;this.renderTableContent(o,l,a,e,i),this.flexContainer.appendChild(t)}if(t){const e=document.createElement("button");e.type="button",e.className="toggle-actions-button",e.textContent=this.areActionButtonsVisible?"â—€":"â–¶",e.title=this.areActionButtonsVisible?"Masquer les boutons d'action":"Afficher les boutons d'action",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.minWidth="32px",e.style.height="32px",e.style.cursor="pointer",e.style.fontSize="16px",e.style.color="#007acc",e.style.border="1px solid #b3d7ff",e.style.borderRadius="50%",e.style.margin="6px",e.style.background="white",e.style.boxShadow="0 1px 4px rgba(0,0,0,0.08)",e.style.transition="all 0.2s",e.style.zIndex="1000",e.onmouseover=()=>{e.style.background="#e6f2ff",e.style.borderColor="#007acc",e.style.transform="scale(1.1)"},e.onmouseout=()=>{e.style.background="white",e.style.borderColor="#b3d7ff",e.style.transform="scale(1)"},e.onclick=t=>{t.preventDefault(),t.stopPropagation(),this.areActionButtonsVisible=!this.areActionButtonsVisible,e.textContent=this.areActionButtonsVisible?"â—€":"â–¶",e.title=this.areActionButtonsVisible?"Masquer les boutons d'action":"Afficher les boutons d'action",s.style.display=this.areActionButtonsVisible?"flex":"none",d.style.display=this.areActionButtonsVisible?"flex":"none",r&&(r.style.display=this.areActionButtonsVisible?"flex":"none")},this.flexContainer.appendChild(e)}const s=document.createElement("button");s.type="button",s.className="add-column-button",s.style.display=this.areActionButtonsVisible?"flex":"none",s.style.alignItems="center",s.style.justifyContent="center",s.style.minWidth="40px",s.style.cursor="pointer",s.style.opacity="0.5",s.style.transition="opacity 0.2s",s.style.fontSize="18px",s.style.color="#666",s.style.border="2px dashed #ccc",s.style.borderRadius="6px",s.style.margin="10px",s.style.padding="12px",s.style.background="transparent",s.style.zIndex="1000",s.textContent="âž•",s.title="Ajouter une nouvelle colonne",s.onmouseover=()=>{s.style.opacity="1",s.style.borderColor="#999"},s.onmouseout=()=>{s.style.opacity="0.5",s.style.borderColor="#ccc"},s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=this.columnTitles.length+1,o="COLONNE "+t;this.host.persistProperties({merge:[{objectName:"titresColonnes",selector:null,properties:{["titre"+t]:o}}]})},!0),s.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation()},!0),s.addEventListener("mouseup",e=>{e.preventDefault(),e.stopPropagation()},!0),this.flexContainer.appendChild(s);let r=null;if(n>1){const e=[];for(let t=1;t<=n;t++)0===this.allRowsData.filter(e=>e.columnIndex===t&&!e.isHidden).length&&e.push(t);e.length>0&&(r=document.createElement("button"),r.type="button",r.className="remove-column-button",r.style.display=this.areActionButtonsVisible?"flex":"none",r.style.alignItems="center",r.style.justifyContent="center",r.style.minWidth="40px",r.style.cursor="pointer",r.style.opacity="0.7",r.style.transition="opacity 0.2s",r.style.fontSize="18px",r.style.color="#c00",r.style.border="2px dashed #c00",r.style.borderRadius="6px",r.style.margin="10px",r.style.padding="12px",r.style.background="transparent",r.style.zIndex="1000",r.textContent="ðŸ—‘ï¸",r.title=`Supprimer toutes les colonnes vides (${e.join(", ")})`,r.onclick=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.forEach(e=>{this.host.persistProperties({replace:[{objectName:"titresColonnes",selector:null,properties:{["titre"+e]:void 0}}]})})},this.flexContainer.appendChild(r))}const d=document.createElement("button");d.type="button",d.className="add-line-button",d.style.display=this.areActionButtonsVisible?"flex":"none";const c=document.createElement("span");c.style.display="flex",c.style.alignItems="center",c.style.gap="6px";const m=document.createElement("span");m.style.display="flex",m.style.alignItems="center",m.style.justifyContent="center",m.style.width="22px",m.style.height="22px",m.style.background="#e6f2ff",m.style.borderRadius="50%",m.style.border="1px solid #b3d7ff",m.style.color="#007acc",m.style.fontSize="16px",m.style.fontWeight="bold",m.style.boxSizing="border-box",m.textContent="+";const u=document.createElement("span");u.style.color="#007acc",u.style.fontSize="14px",u.style.fontWeight="500",u.textContent="Ligne",c.appendChild(m),c.appendChild(u),d.appendChild(c),d.title="Ajouter une nouvelle ligne",d.style.margin="6px",d.style.padding="2px 12px",d.style.background="white",d.style.border="1px solid #b3d7ff",d.style.borderRadius="18px",d.style.boxShadow="0 1px 4px rgba(0,0,0,0.04)",d.style.cursor="pointer",d.style.alignItems="center",d.style.justifyContent="center",d.style.fontFamily="'Segoe UI', Arial, sans-serif",d.style.fontSize="14px",d.onmouseover=()=>{d.style.background="#e6f2ff",d.style.borderColor="#007acc"},d.onmouseout=()=>{d.style.background="white",d.style.borderColor="#b3d7ff"},d.onclick=e=>{e.preventDefault(),e.stopPropagation();let t=1;for(;this.manualLineKeys.includes("manualLine"+t);)t++;const o="manualLine"+t;this.host.persistProperties({merge:[{objectName:o,selector:null,properties:{text:"Nouvelle Ligne "+t,show:!0,col:1,pos:0,isHeader:!1,bgColor:{solid:{color:"transparent"}},textColor:{solid:{color:"black"}},marginTop:0,fontSize:12,bold:!1,italic:!1}}]})},this.flexContainer.appendChild(d)}getFormattingModel(){const e=this.formattingSettings;if(this.metadata&&this.metadata.objects&&this.metadata.objects.titresColonnes){const t=this.metadata.objects.titresColonnes;e.titresColonnes.slices.forEach(e=>{t[e.name]&&(e.value=t[e.name])})}if(this.metadata&&this.metadata.objects&&this.metadata.objects.selectionMenu&&(e.selectionMenu.ligneActive.value=this.metadata.objects.selectionMenu.ligneActive),this.categoricalData){const t=this.categoricalData.categories[0],o=t.values.findIndex(e=>e.toString()===this.currentSelectedLabel);if(-1!==o){const a=e.styleLigne,l=this.host.createSelectionIdBuilder().withCategory(t,o).createSelectionId().getSelector();a.selector=l,(a.slices||[]).forEach(e=>{e.selector=l});const i=this.allRowsData.find(e=>e.originalName===this.currentSelectedLabel);i&&(a.slices||[]).forEach(e=>{const t=e.name;if(t)switch(t){case"columnIndex":e.value=i.columnIndex;break;case"ordreTri":e.value=i.sortIndex;break;case"marginTop":e.value=i.marginTop;break;case"marginBottom":e.value=i.marginBottom;break;case"marginColor":e.value={value:i.marginColor};break;case"isHidden":e.value=i.isHidden;break;case"isHeader":e.value=i.isHeader;break;case"customLabel":e.value=i.customLabel||"";break;case"customAmount":e.value=i.customAmount||"";break;case"fontSize":e.value=i.fontSize;break;case"fontFamily":e.value=i.font;break;case"bgLabel":e.value={value:i.bgLabel};break;case"fillLabel":e.value={value:i.colorLabel};break;case"boldLabel":e.value=i.boldLabel;break;case"italicLabel":e.value=i.italicLabel;break;case"bgAmount":e.value={value:i.bgAmount};break;case"fillAmount":e.value={value:i.colorAmount};break;case"boldAmount":e.value=i.boldAmount;break;case"borderWidth":e.value=i.borderWidth;break;case"borderColor":e.value={value:i.borderColor}}})}}if(this.metadata&&this.metadata.objects&&Object.keys(this.metadata.objects).filter(e=>e.startsWith("manualLine")).sort().forEach(t=>{const o=this.metadata.objects[t],a=new l.gj;a.name=t,a.displayName=o.text?String(o.text):t,a.text.value=o.text,a.show.value=o.show,a.col.value=o.col,a.pos.value=o.pos,a.isHeader.value=o.isHeader,o.bgColor&&(a.bgColor.value=o.bgColor.solid.color),o.textColor&&(a.textColor.value=o.textColor.solid.color),a.marginTop.value=o.marginTop,a.fontSize.value=o.fontSize,a.bold.value=o.bold,a.italic.value=o.italic,a.borderWidth.value=o.borderWidth,o.borderColor&&(a.borderColor.value=o.borderColor.solid.color),e.cards.push(a)}),this.metadata&&this.metadata.objects&&this.metadata.objects.tableBorders){const t=this.metadata.objects.tableBorders;e.tableBorders.borderWidth.value=t.borderWidth,e.tableBorders.borderRadius.value=t.borderRadius,t.borderColor&&(e.tableBorders.borderColor.value=t.borderColor.solid.color),t.borderStyle&&(e.tableBorders.borderStyle.value={value:t.borderStyle,displayName:t.borderStyle})}return this.formattingSettingsService.buildFormattingModel(e)}renderTableContent(e,t,o,a,l){o.sort((e,t)=>e.sortIndex-t.sortIndex);const i=document.createElement("thead"),n=document.createElement("tr"),s=document.createElement("th");s.colSpan=2,s.style.position="relative",s.style.paddingRight="30px";const r=document.createElement("span");r.innerText=t,r.contentEditable="false",r.style.outline="none",r.style.display="inline-block",r.style.minWidth="100px",s.appendChild(r);const d=document.createElement("button");d.innerText="âœï¸",d.style.position="absolute",d.style.right="5px",d.style.top="50%",d.style.transform="translateY(-50%)",d.style.cursor="pointer",d.style.fontSize="14px",d.style.opacity="0.6",d.style.transition="opacity 0.2s",d.style.border="none",d.style.background="transparent",d.style.padding="2px 6px",d.style.zIndex="1000",d.title="Renommer cette colonne",d.type="button",d.onmouseover=()=>{d.style.opacity="1"},d.onmouseout=()=>{d.style.opacity="0.6"};const c=()=>{const e=r.innerText.trim();e&&e!==t&&this.host.persistProperties({merge:[{objectName:"titresColonnes",selector:null,properties:{["titre"+a]:e}}]}),r.contentEditable="false",r.style.backgroundColor="transparent",r.style.color="",r.style.padding="0",d.innerText="âœï¸",d.style.color=""};r.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),c()),"Escape"===e.key&&(r.innerText=t,r.contentEditable="false",r.style.backgroundColor="transparent",r.style.color="",r.style.padding="0",d.innerText="âœï¸",d.style.color="")}),r.addEventListener("blur",()=>{"true"===r.contentEditable&&c()}),d.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),"true"===r.contentEditable?c():(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),r.contentEditable="true",r.style.backgroundColor="#fff3cd",r.style.color="#000000",r.style.padding="2px 4px",r.style.borderRadius="3px",r.focus();const t=document.createRange();t.selectNodeContents(r);const o=window.getSelection();o?.removeAllRanges(),o?.addRange(t),d.innerText="âœ“",d.style.color="green"})(e)},!0),d.addEventListener("mousedown",e=>{e.stopPropagation()},!0),d.addEventListener("mouseup",e=>{e.stopPropagation()},!0),s.appendChild(d),n.appendChild(s),i.appendChild(n),e.appendChild(i);const m=document.createElement("tbody");o.forEach(e=>{if(e.isHidden)return;if(e.marginTop>0){const t=document.createElement("tr");t.style.height=e.marginTop+"px",t.style.lineHeight="0",t.style.fontSize="0";const o=document.createElement("td");o.colSpan=2,o.style.backgroundColor=e.marginColor,o.style.border="none",o.style.padding="0",o.style.margin="0",o.style.height=e.marginTop+"px",t.appendChild(o),m.appendChild(t)}const t=document.createElement("tr");t.draggable=!0,t.style.cursor="move",t.ondragstart=o=>{if(o.stopPropagation(),o.dataTransfer){o.dataTransfer.effectAllowed="move";const a={label:e.label,originalName:e.originalName,columnIndex:e.columnIndex,sortIndex:e.sortIndex,isVirtual:e.isVirtual};o.dataTransfer.setData("text/plain",JSON.stringify(a)),t.style.opacity="0.5",console.log("DRAG START:",a)}},t.ondragend=e=>{t.style.opacity="1"},t.ondragover=e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),t.style.borderTop="2px solid #007acc"},t.ondragleave=e=>{t.style.borderTop=""},t.ondrop=i=>{if(i.preventDefault(),i.stopPropagation(),t.style.borderTop="",console.log("DROP ON ROW",{target:e.originalName}),i.dataTransfer){const t=i.dataTransfer.getData("text/plain"),n=JSON.parse(t),s=n.originalName,r=n.isVirtual;if(s!==e.originalName){const t=o.findIndex(t=>t.originalName===e.originalName);let i=-1e3;i=t>0?o[t-1].sortIndex:e.sortIndex-20;let n=(i+e.sortIndex)/2;if(r){const e=this.allRowsData.find(e=>e.originalName===s);if(e){for(e.columnIndex=a,e.sortIndex=n,this.pendingChanges.set(s,{columnIndex:a,sortIndex:n,timestamp:Date.now()}),this.persistStyle(null,{col:a,pos:n},s),console.log("PERSIST (virtual) ->",{object:s,props:{col:a,pos:n}});this.flexContainer.firstChild;)this.flexContainer.removeChild(this.flexContainer.firstChild);let t=1;this.allRowsData.forEach(e=>{e.columnIndex>t&&(t=e.columnIndex)});let o=Math.max(t,this.columnTitles.length);for(let e=1;e<=o;e++){const t=document.createElement("div");t.className="dynamic-column";const o=document.createElement("table");t.appendChild(o);const a=this.allRowsData.filter(t=>t.columnIndex===e),i=this.columnTitles[e-1]||"COLONNE "+e;this.renderTableContent(o,i,a,e,l),this.flexContainer.appendChild(t)}}}else if(l){const e=l.values.findIndex(e=>e.toString()===s);if(-1!==e){const t=this.host.createSelectionIdBuilder().withCategory(l,e).createSelectionId(),o=this.allRowsData.find(e=>e.originalName===s);let i={};if(o)i.marginBottom=o.marginBottom,i.marginTop=o.marginTop,i.isHidden=o.isHidden,i.marginColor={solid:{color:o.marginColor}},i.customLabel=o.customLabel||"",i.customAmount=o.customAmount||"",i.isHeader=o.isHeader,i.fontSize=o.fontSize,i.fontFamily=o.font,i.bgLabel={solid:{color:o.bgLabel}},i.fillLabel={solid:{color:o.colorLabel}},i.italicLabel=o.italicLabel,i.boldLabel=o.boldLabel,i.bgAmount={solid:{color:o.bgAmount}},i.fillAmount={solid:{color:o.colorAmount}},i.boldAmount=o.boldAmount;else if(l.objects&&l.objects[e]){const t=l.objects[e].styleLigne;t&&Object.keys(t).forEach(e=>{"columnIndex"!==e&&"ordreTri"!==e&&(i[e]=t[e])})}i.columnIndex=a,i.ordreTri=n,Object.keys(i).forEach(e=>{void 0===i[e]&&delete i[e]}),console.log("PERSIST (category) -> selector:",t.getSelector(),"props:",i),this.persistStyle(t.getSelector(),i,"styleLigne"),console.log("PERSIST DONE (category) for",s);const r=this.allRowsData.find(e=>e.originalName===s);if(r){for(r.columnIndex=a,r.sortIndex=n,this.pendingChanges.set(s,{columnIndex:a,sortIndex:n,marginBottom:r.marginBottom,marginTop:r.marginTop,isHidden:r.isHidden,marginColor:r.marginColor,customLabel:r.customLabel,customAmount:r.customAmount,isHeader:r.isHeader,fontSize:r.fontSize,font:r.font,bgLabel:r.bgLabel,colorLabel:r.colorLabel,italicLabel:r.italicLabel,boldLabel:r.boldLabel,bgAmount:r.bgAmount,colorAmount:r.colorAmount,boldAmount:r.boldAmount,timestamp:Date.now()});this.flexContainer.firstChild;)this.flexContainer.removeChild(this.flexContainer.firstChild);let e=1;this.allRowsData.forEach(t=>{t.columnIndex>e&&(e=t.columnIndex)});let t=Math.max(e,this.columnTitles.length);for(let e=1;e<=t;e++){const t=document.createElement("div");t.className="dynamic-column";const o=document.createElement("table");t.appendChild(o);const a=this.allRowsData.filter(t=>t.columnIndex===e),i=this.columnTitles[e-1]||"COLONNE "+e;this.renderTableContent(o,i,a,e,l),this.flexContainer.appendChild(t)}}}}}}},e.isVirtual?(t.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation(),this.selectionManager.showContextMenu(null,{x:e.clientX,y:e.clientY})},t.title="Glisser pour dÃ©placer | Clic droit pour options"):(t.onclick=o=>{t.draggable&&1===o.detail&&(o.stopPropagation(),this.host.persistProperties({merge:[{objectName:"selectionMenu",selector:null,properties:{ligneActive:e.originalName}}]}),this.showToolbar(e,t,o.clientX,o.clientY,l))},t.oncontextmenu=t=>{t.preventDefault(),t.stopPropagation();const o=l.values.findIndex(t=>t.toString()===e.originalName);if(-1!==o){const e=this.host.createSelectionIdBuilder().withCategory(l,o).createSelectionId();this.selectionManager.showContextMenu(e,{x:t.clientX,y:t.clientY})}},t.title="Cliquer pour modifier | Glisser pour dÃ©placer | Clic droit pour options");let i="";if(e.customAmount&&""!==e.customAmount.trim())i=e.customAmount;else{let t=parseFloat(e.amount);e.isVirtual||e.isHeader||!e.amount||isNaN(t)||0===t||(i=new Intl.NumberFormat("fr-FR",{style:"decimal",minimumFractionDigits:0}).format(t))}t.style.fontFamily=e.font,t.style.fontSize=e.fontSize+"px";const n=document.createElement("td");n.innerText=e.label;const s=(e.isHeader||e.isVirtual,e.bgLabel);n.style.backgroundColor=s,n.style.color=e.colorLabel,e.boldLabel&&(n.style.fontWeight="bold"),e.italicLabel&&(n.style.fontStyle="italic");const r=`${e.borderWidth}px solid ${e.borderColor}`;n.style.border=r,n.style.borderRight="none",t.appendChild(n);const d=document.createElement("td");if(d.innerText=i,d.style.textAlign="right",d.style.backgroundColor=e.isHeader||e.isVirtual?e.bgLabel:e.bgAmount,d.style.color=e.colorAmount,e.boldAmount&&(d.style.fontWeight="bold"),d.style.border=r,d.style.borderLeft="none",t.appendChild(d),m.appendChild(t),e.marginBottom>0){const t=document.createElement("tr");t.style.height=e.marginBottom+"px",t.style.lineHeight="0",t.style.fontSize="0";const o=document.createElement("td");o.colSpan=2,o.style.backgroundColor=e.marginColor,o.style.border="none",o.style.padding="0",o.style.margin="0",o.style.height=e.marginBottom+"px",t.appendChild(o),m.appendChild(t)}});const u=document.createElement("tr");u.style.height="40px";const p=document.createElement("td");p.colSpan=2,p.style.backgroundColor="transparent",p.style.border="2px dashed transparent",p.style.transition="all 0.2s",p.textContent="",u.appendChild(p),u.ondragover=e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),p.style.border="2px dashed #007acc",p.style.backgroundColor="rgba(0, 122, 204, 0.1)"},u.ondragleave=e=>{p.style.border="2px dashed transparent",p.style.backgroundColor="transparent"},u.ondrop=e=>{if(e.preventDefault(),e.stopPropagation(),p.style.border="2px dashed transparent",p.style.backgroundColor="transparent",e.dataTransfer){const t=e.dataTransfer.getData("text/plain"),i=JSON.parse(t),n=i.originalName,s=i.isVirtual;let r=0;o.length>0&&(r=o[o.length-1].sortIndex);let d=r+10;if(s){const e=this.allRowsData.find(e=>e.originalName===n);if(e){for(e.columnIndex=a,e.sortIndex=d,this.pendingChanges.set(n,{columnIndex:a,sortIndex:d,timestamp:Date.now()}),this.persistStyle(null,{col:a,pos:d},n),console.log("PERSIST (virtual) ->",{object:n,props:{col:a,pos:d}});this.flexContainer.firstChild;)this.flexContainer.removeChild(this.flexContainer.firstChild);let t=1;this.allRowsData.forEach(e=>{e.columnIndex>t&&(t=e.columnIndex)});let o=Math.max(t,this.columnTitles.length);for(let e=1;e<=o;e++){const t=document.createElement("div");t.className="dynamic-column";const o=document.createElement("table");t.appendChild(o);const a=this.allRowsData.filter(t=>t.columnIndex===e),i=this.columnTitles[e-1]||"COLONNE "+e;this.renderTableContent(o,i,a,e,l),this.flexContainer.appendChild(t)}}}else if(l){const e=l.values.findIndex(e=>e.toString()===n);if(-1!==e){const t=this.host.createSelectionIdBuilder().withCategory(l,e).createSelectionId(),o=this.allRowsData.find(e=>e.originalName===n);let i={marginBottom:0,marginTop:0,isHidden:!1,marginColor:{solid:{color:"transparent"}},customLabel:"",customAmount:"",isHeader:!1,fontSize:12,fontFamily:"'Segoe UI', sans-serif",bgLabel:{solid:{color:"transparent"}},fillLabel:{solid:{color:"black"}},italicLabel:!1,boldLabel:!1,bgAmount:{solid:{color:"transparent"}},fillAmount:{solid:{color:"black"}},boldAmount:!1};if(o)i.marginBottom=o.marginBottom,i.marginTop=o.marginTop,i.isHidden=o.isHidden,i.marginColor={solid:{color:o.marginColor}},i.customLabel=o.customLabel||"",i.customAmount=o.customAmount||"",i.isHeader=o.isHeader,i.fontSize=o.fontSize,i.fontFamily=o.font,i.bgLabel={solid:{color:o.bgLabel}},i.fillLabel={solid:{color:o.colorLabel}},i.italicLabel=o.italicLabel,i.boldLabel=o.boldLabel,i.bgAmount={solid:{color:o.bgAmount}},i.fillAmount={solid:{color:o.colorAmount}},i.boldAmount=o.boldAmount;else if(l.objects&&l.objects[e]){const t=l.objects[e].styleLigne;t&&Object.keys(t).forEach(e=>{"columnIndex"!==e&&"ordreTri"!==e&&(i[e]=t[e])})}i.columnIndex=a,i.ordreTri=d,Object.keys(i).forEach(e=>{void 0===i[e]&&delete i[e]}),console.log("PERSIST (category) -> selector:",t.getSelector(),"props:",i),this.persistStyle(t.getSelector(),i,"styleLigne"),console.log("PERSIST DONE (category) for",n);const s=this.allRowsData.find(e=>e.originalName===n);if(s){for(s.columnIndex=a,s.sortIndex=d,this.pendingChanges.set(n,{columnIndex:a,sortIndex:d,marginBottom:s.marginBottom,marginTop:s.marginTop,isHidden:s.isHidden,marginColor:s.marginColor,customLabel:s.customLabel,customAmount:s.customAmount,isHeader:s.isHeader,fontSize:s.fontSize,font:s.font,bgLabel:s.bgLabel,colorLabel:s.colorLabel,italicLabel:s.italicLabel,boldLabel:s.boldLabel,bgAmount:s.bgAmount,colorAmount:s.colorAmount,boldAmount:s.boldAmount,timestamp:Date.now()});this.flexContainer.firstChild;)this.flexContainer.removeChild(this.flexContainer.firstChild);let e=1;this.allRowsData.forEach(t=>{t.columnIndex>e&&(e=t.columnIndex)});let t=Math.max(e,this.columnTitles.length);for(let e=1;e<=t;e++){const t=document.createElement("div");t.className="dynamic-column";const o=document.createElement("table");t.appendChild(o);const a=this.allRowsData.filter(t=>t.columnIndex===e),i=this.columnTitles[e-1]||"COLONNE "+e;this.renderTableContent(o,i,a,e,l),this.flexContainer.appendChild(t)}}}}}},m.appendChild(u),e.appendChild(m)}showToolbar(e,t,o,a,l){if(console.log("ðŸŸ¢ showToolbar called for:",e.originalName),!l)return void console.error("ðŸ”´ Categories is null");for(;this.toolbar.firstChild;)this.toolbar.removeChild(this.toolbar.firstChild);this.toolbar.style.display="flex",this.toolbar.onmousedown=e=>e.stopPropagation(),this.toolbar.onclick=e=>e.stopPropagation();let i=o-200;i<10&&(i=10),i+400>window.innerWidth&&(i=window.innerWidth-400-10);let n=a-50;n<10&&(n=a+20),this.toolbar.style.left=i+"px",this.toolbar.style.top=n+"px";const s=l.values.findIndex(t=>t.toString()===e.originalName);if(console.log("ðŸŸ¢ Index found:",s),-1===s)return void console.error("ðŸ”´ Index not found for",e.originalName);let r=this.host.createSelectionIdBuilder();r=r.withCategory(l,s);const d=r.createSelectionId(),c=t=>{const o={...this.pendingChanges.get(e.originalName)||{timestamp:Date.now()},...t,timestamp:Date.now()};this.pendingChanges.set(e.originalName,o)},m=()=>this.allRowsData.find(t=>t.originalName===e.originalName)||e,u=e=>{const t=m(),o={columnIndex:t.columnIndex,ordreTri:t.sortIndex,marginBottom:t.marginBottom,marginTop:t.marginTop,isHidden:t.isHidden,marginColor:{solid:{color:t.marginColor}},customLabel:t.customLabel||"",customAmount:t.customAmount||"",isHeader:t.isHeader,fontSize:t.fontSize,fontFamily:t.font,bgLabel:{solid:{color:t.bgLabel}},fillLabel:{solid:{color:t.colorLabel}},italicLabel:t.italicLabel,boldLabel:t.boldLabel,bgAmount:{solid:{color:t.bgAmount}},fillAmount:{solid:{color:t.colorAmount}},boldAmount:t.boldAmount,borderWidth:t.borderWidth,borderColor:{solid:{color:t.borderColor}}};Object.keys(e||{}).forEach(t=>{o[t]=e[t]});try{this.host.persistProperties({merge:[{objectName:"styleLigne",selector:d.getSelector(),properties:o}]}),c(o)}catch(e){console.error("Erreur persistProperties:",e)}},p=document.createElement("button"),b=document.createElement("b");b.textContent="B",p.appendChild(b),p.title="Gras",e.boldLabel&&(p.className="active"),p.onclick=o=>{o.stopPropagation();const a=!e.boldLabel;p.className=a?"active":"",e.boldLabel=a,e.boldAmount=a;const l=a?"bold":"normal";t.cells[0]&&(t.cells[0].style.fontWeight=l),t.cells[1]&&(t.cells[1].style.fontWeight=l),c({boldLabel:a,boldAmount:a}),u({boldLabel:a,boldAmount:a})},this.toolbar.appendChild(p);const h=document.createElement("button"),g=document.createElement("i");g.textContent="I",h.appendChild(g),h.title="Italique",e.italicLabel&&(h.className="active"),h.onclick=o=>{o.stopPropagation();const a=!e.italicLabel;h.className=a?"active":"",e.italicLabel=a;const l=a?"italic":"normal";t.cells[0]&&(t.cells[0].style.fontStyle=l),c({italicLabel:a}),u({italicLabel:a})},this.toolbar.appendChild(h);const y=document.createElement("div");y.className="separator",this.toolbar.appendChild(y);const f=document.createElement("div");f.className="font-size-wrapper";const v=document.createElement("label");v.innerText="Taille",v.style.marginRight="4px",f.appendChild(v);const C=document.createElement("select");C.title="Taille de police";for(let t=8;t<=24;t++){const o=document.createElement("option");o.value=t.toString(),o.innerText=t.toString(),e.fontSize===t&&(o.selected=!0),C.appendChild(o)}C.onchange=o=>{o.stopPropagation();const a=parseInt(C.value,10);e.fontSize=a,t.style.fontSize=a+"px",c({fontSize:a}),u({fontSize:a})},f.appendChild(C),this.toolbar.appendChild(f);const x=document.createElement("div");x.className="separator",this.toolbar.appendChild(x);const S=document.createElement("div");S.className="font-family-wrapper";const L=document.createElement("label");L.innerText="Police",L.style.marginRight="4px",S.appendChild(L);const N=document.createElement("select");N.title="Police",[{name:"Segoe UI",value:"'Segoe UI', sans-serif"},{name:"Arial",value:"Arial, sans-serif"},{name:"Calibri",value:"Calibri, sans-serif"},{name:"Times New Roman",value:"'Times New Roman', serif"},{name:"Courier New",value:"'Courier New', monospace"}].forEach(t=>{const o=document.createElement("option");o.value=t.value,o.innerText=t.name,e.font===t.value&&(o.selected=!0),N.appendChild(o)}),N.onchange=o=>{o.stopPropagation();const a=N.value;e.font=a,t.style.fontFamily=a,c({font:a}),u({fontFamily:a})},S.appendChild(N),this.toolbar.appendChild(S);const E=document.createElement("button");E.className="close-btn",E.textContent="âœ–",E.onclick=e=>{e.stopPropagation(),this.toolbar.style.display="none"},this.toolbar.appendChild(E)}}}},t={};function o(a){var l=t[a];if(void 0!==l)return l.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{o.r(a),o.d(a,{default:()=>i});var e=o(849),t=window.powerbi,l={name:"monTableauPersoCF0BED4C19044D588EBF656397EF1EB4",displayName:"monTableauPerso",class:"Visual",apiVersion:"5.10.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,o)=>{const a=globalThis.dialogRegistry;e in a&&new a[e](t,o)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.monTableauPersoCF0BED4C19044D588EBF656397EF1EB4=l);const i=l})(),monTableauPersoCF0BED4C19044D588EBF656397EF1EB4=a})();