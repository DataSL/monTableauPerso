{"version":3,"file":"visual.js","mappings":"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","sources":["webpack:///./src/visual.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./.tmp/precompile/visualPlugin.ts"],"sourcesContent":["\"use strict\";\n\nimport powerbi from \"powerbi-visuals-api\";\nimport VisualConstructorOptions = powerbi.extensibility.visual.VisualConstructorOptions;\nimport VisualUpdateOptions = powerbi.extensibility.visual.VisualUpdateOptions;\nimport IVisual = powerbi.extensibility.visual.IVisual;\n\nimport \"../style/visual.less\";\n\nexport class Visual implements IVisual {\n    private target: HTMLElement;\n\n    constructor(options: VisualConstructorOptions) {\n        this.target = options.element;\n    }\n\n    public update(options: VisualUpdateOptions) {\n        this.target.innerHTML = \"\";\n\n        const dataView = options.dataViews[0];\n        if (!dataView || !dataView.table) return;\n\n        const table = dataView.table;\n        let rows = table.rows; // On récupère les lignes\n        \n        // --- 1. REPERER LES INDEX ---\n        let indexLibelle = -1;\n        let indexMontant = -1;\n        let indexCote = -1;\n        let indexType = -1;\n        let indexOrder = -1; // Nouvel index pour le tri\n\n        table.columns.forEach((col, index) => {\n            if (col.roles) {\n                if (col.roles[\"category\"]) indexLibelle = index;\n                if (col.roles[\"measure\"]) indexMontant = index;\n                if (col.roles[\"position\"]) indexCote = index;\n                if (col.roles[\"rowType\"]) indexType = index;\n                if (col.roles[\"order\"]) indexOrder = index; // On repère la colonne Ordre\n            }\n        });\n\n        // --- 2. TRIER LES LIGNES (CORRECTION DU PROBLEME) ---\n        // Si on a trouvé la colonne ordre, on trie le tableau rows\n        if (indexOrder >= 0) {\n            rows = rows.sort((rowA, rowB) => {\n                const valA = rowA[indexOrder] as number;\n                const valB = rowB[indexOrder] as number;\n                return valA - valB; // Tri croissant (1, 2, 3...)\n            });\n        }\n\n        // --- 3. CREATION HTML ---\n        const container = document.createElement(\"div\");\n        container.className = \"container\";\n\n        const leftDiv = document.createElement(\"div\");\n        leftDiv.className = \"column-block\";\n        leftDiv.innerHTML = \"<div class='header-main'>CHARGES</div>\";\n        const leftTable = document.createElement(\"table\");\n        leftDiv.appendChild(leftTable);\n\n        const rightDiv = document.createElement(\"div\");\n        rightDiv.className = \"column-block\";\n        rightDiv.innerHTML = \"<div class='header-main'>PRODUITS</div>\";\n        const rightTable = document.createElement(\"table\");\n        rightDiv.appendChild(rightTable);\n\n        // --- 4. BOUCLE D'AFFICHAGE ---\n        rows.forEach(row => {\n            let label = (indexLibelle >= 0 && row[indexLibelle]) ? row[indexLibelle].toString() : \"\";\n            const rawAmount = (indexMontant >= 0 && row[indexMontant] != null) ? row[indexMontant] : null;\n            const position = (indexCote >= 0 && row[indexCote]) ? row[indexCote].toString().toLowerCase() : \"g\";\n            const type = (indexType >= 0 && row[indexType]) ? row[indexType].toString().toLowerCase() : \"normal\";\n            if (!label || label.trim() === \"\") {\n                label = \"\\u00A0\"; \n            }\n            // Formatage Monétaire\n            let displayAmount = \"\";\n            \n            // CORRECTION ICI : On vérifie si c'est 0\n            // On convertit en nombre pour être sûr\n            const numericAmount = rawAmount !== null ? Number(rawAmount) : 0;\n\n            if (rawAmount !== null && rawAmount !== \"\") {\n                // Si c'est 0 sur une ligne normale, on veut du vide (pas \"0 €\")\n                if (numericAmount === 0 && type === \"normal\") {\n                    displayAmount = \"\"; \n                } else {\n                    displayAmount = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(numericAmount);\n                }\n            }\n\n            const tr = document.createElement(\"tr\");\n\n            // Gestion des styles\n            if (type.includes(\"header\") || type.includes(\"titre\")) {\n                tr.className = \"row-header\";\n                displayAmount = \"\"; // Toujours vide pour les titres\n            } else if (type.includes(\"total\")) {\n                tr.className = \"row-total\";\n            } else {\n                tr.className = \"row-normal\";\n            }\n\n            const tdName = document.createElement(\"td\");\n            tdName.innerText = label;\n            tr.appendChild(tdName);\n\n            const tdAmount = document.createElement(\"td\");\n            tdAmount.className = \"amount-cell\";\n            tdAmount.innerText = displayAmount;\n            tr.appendChild(tdAmount);\n\n            if (position.includes(\"d\") || position.includes(\"right\")) {\n                rightTable.appendChild(tr);\n            } else {\n                leftTable.appendChild(tr);\n            }\n        });\n\n        container.appendChild(leftDiv);\n        container.appendChild(rightDiv);\n        this.target.appendChild(container);\n    }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { Visual } from \"../../src/visual\";\nimport powerbiVisualsApi from \"powerbi-visuals-api\";\nimport IVisualPlugin = powerbiVisualsApi.visuals.plugins.IVisualPlugin;\nimport VisualConstructorOptions = powerbiVisualsApi.extensibility.visual.VisualConstructorOptions;\nimport DialogConstructorOptions = powerbiVisualsApi.extensibility.visual.DialogConstructorOptions;\nvar powerbiKey: any = \"powerbi\";\nvar powerbi: any = window[powerbiKey];\nvar monTableauPersoCF0BED4C19044D588EBF656397EF1EB4_DEBUG: IVisualPlugin = {\n    name: 'monTableauPersoCF0BED4C19044D588EBF656397EF1EB4_DEBUG',\n    displayName: 'monTableauPerso',\n    class: 'Visual',\n    apiVersion: '5.3.0',\n    create: (options?: VisualConstructorOptions) => {\n        if (Visual) {\n            return new Visual(options);\n        }\n        throw 'Visual instance not found';\n    },\n    createModalDialog: (dialogId: string, options: DialogConstructorOptions, initialState: object) => {\n        const dialogRegistry = (<any>globalThis).dialogRegistry;\n        if (dialogId in dialogRegistry) {\n            new dialogRegistry[dialogId](options, initialState);\n        }\n    },\n    custom: true\n};\nif (typeof powerbi !== \"undefined\") {\n    powerbi.visuals = powerbi.visuals || {};\n    powerbi.visuals.plugins = powerbi.visuals.plugins || {};\n    powerbi.visuals.plugins[\"monTableauPersoCF0BED4C19044D588EBF656397EF1EB4_DEBUG\"] = monTableauPersoCF0BED4C19044D588EBF656397EF1EB4_DEBUG;\n}\nexport default monTableauPersoCF0BED4C19044D588EBF656397EF1EB4_DEBUG;"],"names":[],"ignoreList":[],"sourceRoot":""}